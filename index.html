<!DOCTYPE html><html><head><meta charset="UTF-8">
<title>Cracked AI Receptionist</title>
<style>
  body { margin:0; font-family:-apple-system, sans-serif; background:#f2f2f7; color:#1c1c1e; }
  .chat-container { position:fixed; bottom:20px; right:20px; width:360px; max-height:80vh; display:flex; flex-direction:column; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.1); overflow:hidden; background:white; }
  .header { background:#007aff; color:white; padding:15px; font-weight:600; }
  .messages { flex:1; padding:15px; overflow-y:auto; }
  .input-area { display:flex; border-top:1px solid #e5e5ea; }
  .input-area input { flex:1; border:none; padding:12px; font-size:15px; }
  .input-area button { border:none; padding:0 15px; background:#007aff; color:white; cursor:pointer; }
  .msg { margin-bottom:12px; max-width:80%; line-height:1.4; }
  .user { align-self:flex-end; background:#e5e5ea; color:#1c1c1e; padding:10px 14px; border-radius:18px; }
  .bot { align-self:flex-start; background:#f0f0f5; color:#1c1c1e; padding:10px 14px; border-radius:18px; }
  .mic { background:none; border:none; cursor:pointer; font-size:20px; padding:12px;}
</style>
</head><body>

<div class="chat-container">
  <div class="header">AI Receptionist</div>
  <div class="messages" id="msgBox">
    <div class="msg bot">Hi! Welcome to our service. How can I assist you today?</div>
  </div>
  <div class="input-area">
    <button class="mic" id="micBtn">üéôÔ∏è</button>
    <input type="text" id="uInput" placeholder="Ask me anything..." />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script>
const sheetURL = "https://script.google.com/u/0/home/projects/1vN3-i71yfUgJspvb9yxjuenN7pmHiKb5RIa4G-BPP5EKwW3mRxBdkNKv/edit";
let apiKey = "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";
let context = "";
const websiteURL = "https://www.meineke.com";

async function loadContext() {
  try { const t = await fetch(`https://api.allorigins.win/raw?url=${websiteURL}`).then(r=>r.text());
    context = `You are an AI receptionist. Here is website content:\n\n${t}`;
  } catch { context = "You are an AI receptionist."; }
}
loadContext();

function addMsg(text, cls) {
  const mb = document.getElementById('msgBox');
  const el = document.createElement('div');
  el.textContent = text; el.className = 'msg ' + cls;
  mb.appendChild(el); mb.scrollTop = mb.scrollHeight;
}

document.getElementById('sendBtn').onclick = send;
document.getElementById('uInput').addEventListener('keypress', e=>{ if(e.key==='Enter') send(); });
document.getElementById('micBtn').onclick = () => {
  const rec = new (window.SpeechRecognition||window.webkitSpeechRecognition)();
  rec.onresult = e=>{ document.getElementById('uInput').value = e.results[0][0].transcript; send(); };
  rec.start();
};

async function speak(text) {
  const ut = new SpeechSynthesisUtterance(text);
  ut.lang = 'en-US';
  speechSynthesis.speak(ut);
}

async function send() {
  const input = document.getElementById('uInput');
  let text = input.value.trim();
  if(!text) return;
  addMsg(text,'user'); input.value='';
  if(!apiKey) {
    apiKey = prompt("Enter your OpenRouter API key:");
    if(!apiKey) return;
  }

  const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
    method:"POST", headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+apiKey
    },
    body: JSON.stringify({
      model:"openai/gpt-3.5-turbo",
      messages:[
        {role:"system",content:context},
        {role:"user",content:text}
      ]
    })
  });
  const out = await res.json();
  const reply = out.choices?.[0]?.message?.content || "Oops, something went wrong.";
  addMsg(reply,'bot');
  speak(reply);
  handleBooking(reply);
}

async function handleBooking(reply) {
  if(reply.toLowerCase().includes("please provide your name")) {
    const name = prompt("Name?");
    const email = prompt("Email?");
    const phone = prompt("Phone?");
    await fetch(sheetURL,{method:"POST",body:JSON.stringify({name,email,phone})});
  }
  if(reply.toLowerCase().includes("what date would you like")) {
    const d = prompt("Date (YYYY-MM-DD)");
    const t = prompt("Time (HH:MM)");
    await fetch(sheetURL,{method:"POST",body:JSON.stringify({name:"",email:"",phone:"",date:d,time:t})});
  }
}
</script>

</body></html>
